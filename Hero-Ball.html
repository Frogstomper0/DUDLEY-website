<!DOCTYPE html>    
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dudley Redhead Junior Rugby League Club — Mighty Magpies</title>

  <style>
    :root{
      --bg:#000; --fg:#fff; --ink:#111; --paper:#fff; --gap:clamp(12px,2.2vw,24px);
      --radius:14px; --maxw:1200px; --shadow:0 8px 30px rgba(0,0,0,.25);
      --ticker-h:36px; --ticker-offset:36px;
      --fly-w:280px; /* flyout width on open */
      --video-h:700px; /* <<< single source of truth for smash cut height */
    }
    html,body{height:100%}
    body{
      margin:0;
      background: var(--bg) url("img/background.png") center center / cover no-repeat fixed;
      color:var(--fg);
      font:400 16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto;display:block}
    .container{width:min(100% - 2*var(--gap), var(--maxw));margin:0 auto}

    /* ===== TICKER ===== */
    .ticker{
      position:fixed; top:0; left:0; right:0; height:var(--ticker-h);
      background:#111; color:#fff; border-bottom:1px solid #222;
      display:flex; align-items:center; overflow:hidden; z-index:1001;
      transform:translateY(0); transition:transform .2s ease;
    }
    .ticker.hidden{ transform:translateY(-100%); }
    .ticker .lane{ width:100%; overflow:hidden; white-space:nowrap; }
    .ticker .track{ display:inline-flex; white-space:nowrap; will-change:transform; animation: ticker-marquee var(--marquee-duration, 30s) linear infinite; }
    .ticker .copy{ display:inline-block; }
    .ticker .chunk{ display:inline-block; padding:0 .9rem; opacity:.95; }
    .ticker .dot{ opacity:.45; padding:0 .3rem; }
    .ticker.closed{ background:#7e0a0a; border-bottom-color:#4c0505; }
    .ticker.closed .track{ animation:none; }
    @keyframes ticker-marquee{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

    header{
      position:fixed; inset:0 0 auto 0; background:var(--paper); color:var(--ink);
      box-shadow:0 6px 24px rgba(0,0,0,.18); z-index:999;
      transform: translateY(var(--ticker-offset)); transition: transform .2s ease;
    }
    header .nav{
      display:flex; align-items:center; justify-content:space-between;
      gap:var(--gap); padding:0 var(--gap); min-height:72px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px}
    .brand .logo{height:72px; width:auto; object-fit:contain}
    .menu{display:flex; gap:clamp(8px,1.8vw,18px); align-items:center}
    .menu a{padding:10px 12px; border-radius:999px; color:var(--ink)}
    .menu a:hover,.menu a:focus-visible{outline:none;background:#f2f2f2}

    .hero{position:relative; padding-top:calc(72px + var(--ticker-offset)); min-height:92vh; display:grid; place-items:center; overflow:clip}
    .hero-inner{
      width:min(100% - 2*var(--gap), var(--maxw));
      border-radius:var(--radius); outline:1px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow); background:linear-gradient(#0c0c0c,#000); overflow:hidden;
      padding:clamp(18px,2.4vw,28px);
      display:grid; gap:var(--gap);
      grid-template-columns: 0.95fr 1.45fr; align-items:stretch;
    }

    .games-card{
      background:#0f0f0f; border:1px solid #181818; border-radius:16px; padding:14px; display:grid; gap:12px; align-content:start;
      max-width:520px; position:relative;
    }
    .games-card h2{margin:0 0 4px; font-size:clamp(18px,2.6vw,24px)}
    .game-list{list-style:none; padding:0; margin:0; display:grid; gap:10px}
    .game{background:#101010; border:1px solid #1a1a1a; border-radius:12px; padding:10px 12px; display:grid; gap:6px}
    .game .row{display:flex; gap:12px; align-items:baseline; flex-wrap:wrap}
    .game .when{font-weight:700}
    .game .meta{color:#bdbdbd; font-size:14px}
    .source{margin-top:4px; font-size:13px; color:#bdbdbd}
    .badge{position:absolute; right:12px; top:12px; background:#fff;color:#000;border-radius:999px;padding:8px 12px;font-weight:800;letter-spacing:.4px;box-shadow:var(--shadow);opacity:.9}
    .badge .dot{display:inline-block;width:8px;height:8px;border-radius:999px;background:#0a0;margin-right:8px}

    .pitch{position:relative; border-radius:16px; background:linear-gradient(#0b0b0b,#020202); overflow:hidden}
    .pitch svg{width:100%;height:100%;display:block}
    .hero-title{
      position:absolute; left:clamp(16px,3vw,40px); bottom:12px; right:auto;
      font-weight:900; font-size:clamp(26px,4.2vw,48px); letter-spacing:.3px; text-shadow:0 2px 8px rgba(0,0,0,.6);
    }

    @keyframes ball-bounce{
      0%{transform:translate(0,0) rotate(0)} 35%{transform:translate(0,-9vh) rotate(-6deg)}
      70%{transform:translate(0,0) rotate(0)} 85%{transform:translate(0,-3vh) rotate(-3deg)} 100%{transform:translate(0,0) rotate(0)}
    }
    @keyframes ball-hop{ 0%{transform:translate(0,0) rotate(0)} 50%{transform:translate(0,-3vh) rotate(-2deg)} 100%{transform:translate(0,0) rotate(0)} }
    .bounce-once{animation:ball-bounce 1.1s cubic-bezier(.22,.61,.36,1) 1 both}
    .small-hop{animation:ball-hop .7s cubic-bezier(.22,.61,.36,1) 1 both}
    @keyframes bounce{0%,100%{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:translateY(0);animation-timing-function:cubic-bezier(0,0,.2,1)}}
    .animate-bounce{animation:bounce 1s infinite; will-change:transform}
    @media (prefers-reduced-motion:reduce){
      .bounce-once,.small-hop,.animate-bounce{animation:none!important}
      *{scroll-behavior:auto}
    }

    section{padding:clamp(36px,7vw,72px) 0}
    section.light{background:var(--paper); color:var(--ink)}
    section.dark{background:#0a0a0a; color:#fefefe}

    /* === Register layout === */
    .register-grid{display:grid; gap:var(--gap); grid-template-columns:1.1fr 1.25fr; align-items:center}
    .register-grid .video{
      width:500px; height:var(--video-h); justify-self:start;
      border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); background:#111;
      margin-left: calc(-2 * var(--gap) + 8px);
    }
    @media (max-width:900px){
      .register-grid{grid-template-columns:1fr}
      .register-grid .video{ margin-left: 0; height:500px; }
    }
    #promoVideo{ display:block; width:100%; height:100%; object-fit:cover; }
    #promoVideo::-webkit-media-controls{ display:none !important; }

    .register-cta{ display:grid; gap:10px; position:relative; }
    .register-cta::after{
      content:""; position:absolute; inset:0;
      background: url("img/magpies-huddle.png") center 22% / min(70%, 520px) no-repeat;
      opacity:.30; pointer-events:none; z-index:0;
    }
    .register-cta > *{ position:relative; z-index:1; }

    /* ✅ Match bottom gap to the top gap of this section */
    #register{ padding-bottom:clamp(36px,7vw,72px); }

    /* Register button — centered to the results column */
    .register-cta .btn{ width:fit-content; justify-self:center; border-radius:999px; }
    .btn{display:inline-flex; align-items:center; justify-content:center; padding:12px 18px; border-radius:999px; font-weight:800; letter-spacing:.3px; background:#fff; color:#000; transition:transform .08s ease}
    .btn:active{transform:translateY(1px)}

    .shop-grid{ display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); grid-auto-rows:auto; gap:var(--gap); }
    .shop-grid .card{ max-width:100%; }
    .card{background:var(--paper); color:var(--ink); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
    .card .img{aspect-ratio:4/3;background:#e9e9e9;display:grid;place-items:center;color:#777;font-weight:700}
    .card .body{padding:12px 14px; display:grid; gap:4px}

    .sponsors .grid{display:grid; gap:16px; grid-template-columns:repeat(4,1fr); align-items:center; justify-items:center}
    @media (max-width:900px){.sponsors .grid{grid-template-columns:repeat(2,1fr)}}
    .sponsors a{display:grid; place-items:center; width:100%; padding:12px; border-radius:12px; background:#0e0e0e}
    .sponsors img{filter:grayscale(100%); transition:filter .28s ease, transform .28s ease, opacity .28s ease; max-height:60px; opacity:.8}
    .sponsors a:hover img,.sponsors a:focus-visible img{filter:grayscale(0%); transform:scale(1.05); opacity:1}

    .about p{color:#2a2a2a}
    .social .fb-wrap{background:var(--paper); color:var(--ink); border-radius:var(--radius); padding:12px; box-shadow:var(--shadow)}

    /* ===== Feats hover-roller ===== */
    .feats{ padding-left:0; padding-right:0; }
    .feats .container{ width:100%; }
    .feats .container > h2,
    .feats .feats-row{ padding-left:100px; padding-right:100px; }

    .feats .feats-row{
      display:flex; gap:var(--gap);
      height:clamp(220px, 38vh, 380px);
      overflow:visible;
    }
    .feats .feat-card{
      position:relative;
      isolation:isolate;
      display:flex;
      flex:1 1 20%;
      border-radius:12px;
      background:#0e0e0e;
      box-shadow:var(--shadow);
      transition:flex-basis .35s ease, transform .35s ease, opacity .25s ease, margin .25s ease;
      outline:1px solid rgba(255,255,255,.06);
      cursor:pointer;
      margin:0;
    }
    .feats .feats-row:hover .feat-card{ flex-basis:14%; opacity:.85; }
    .feats .feat-card:hover,
    .feats .feat-card:focus-visible,
    .feats .feat-card.active{
      flex-basis:34%;
      opacity:1;
      transform:translateY(-2px) scale(1.04);
      margin-top:-14px;
      margin-bottom:-14px;
    }
    .feats .frame{ display:flex; width:100%; height:100%; border-radius:inherit; overflow:hidden; }
    .feats .frame.fly-right{ flex-direction:row; }
    .feats .frame.fly-left{  flex-direction:row-reverse; }

    .feats .art{ position:relative; flex:1 1 auto; background:#0e0e0e; border-radius:inherit; overflow:hidden; }
    .feats .art::before{ content:""; position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.65), rgba(0,0,0,.15) 50%, transparent 70%); pointer-events:none; z-index:1; }
    .feats .art .img{ position:absolute; inset:0; background-size:cover; background-position:center; transition:opacity .28s ease; }
    .feats .art .img.primary{ opacity:1; }
    .feats .art .img.alt{ opacity:0; }
    .feats .feat-card:hover .art .img.alt,
    .feats .feat-card:focus-visible .art .img.alt,
    .feats .feat-card.active .art .img.alt{ opacity:1; }
    .feats .feat-card:hover .art .img.primary,
    .feats .feat-card:focus-visible .art .img.primary,
    .feats .feat-card.active .art .img.primary{ opacity:0; }

    .feats .cover{ position:absolute; inset:0; z-index:4; }
    .feats .meta{
      position:absolute; left:12px; right:12px; bottom:12px;
      display:grid; gap:4px; color:#fff; text-shadow:0 1px 6px rgba(0,0,0,.5); z-index:3;
    }

    .feats .flyout{
      width:0; flex:0 0 auto; min-width:0; overflow:hidden;
      opacity:0;
      display:flex; align-items:flex-end;
      background:rgba(255,255,255,.12); color:#fff;
      backdrop-filter:saturate(140%) blur(6px);
      border-radius:12px; box-shadow:var(--shadow);
      margin:0;
      padding:12px;
      transition: width .28s cubic-bezier(.22,.9,.24,1), margin .28s cubic-bezier(.22,.9,.24,1), opacity .2s ease, transform .28s cubic-bezier(.22,.9,.24,1);
      z-index:5;
      transform:translateX(0);
    }
    .feats .frame.fly-right .flyout{ transform:translateX(12px); }
    .feats .frame.fly-left  .flyout{ transform:translateX(-12px); }
    .feats .flyout .fly-body{
      font-size:clamp(12px,1.7vw,14px); line-height:1.45;
      display:-webkit-box; -webkit-line-clamp:10; -webkit-box-orient:vertical; overflow:hidden;
    }
    .feats .feat-card:hover .flyout,
    .feats .feat-card:focus-visible .flyout,
    .feats .feat-card.active .flyout{
      width:var(--fly-w);
      margin:12px;
      opacity:1;
      transform:translateX(0);
    }
    @media (hover:none){
      .feats .feats-row{ overflow-x:auto; scroll-snap-type:x mandatory; }
      .feats .feat-card{ min-width:68vw; flex:0 0 auto; scroll-snap-align:center; }
      .feats .meta{ opacity:1; transform:none; }
    }

    footer{padding:28px 0; font-size:14px; color:#9c9c9c; border-top:1px solid #101010}

    /* ===== Social section tweaks ===== */
    .social-row{ display:flex; gap:var(--gap); align-items:flex-start; flex-wrap:wrap; }
    .social .fb-wrap{ flex:0 0 auto; width:fit-content; }
    .social .side-panel{ flex:1 1 260px; display:flex; flex-direction:column; gap:10px; align-self:flex-start; }
    .social .intro h3{ font-weight:900; font-size:clamp(28px,5.2vw,58px); line-height:1.1; letter-spacing:.3px; margin:0; max-width: 12ch; }
    .social .intro p{ margin:6px 0 0; font-size:clamp(14px,1.1vw,16px); line-height:1.5; max-width:44ch; color:#cfcfcf; letter-spacing:.2px; }
    .social .side-image img{ border-radius:var(--radius); box-shadow:var(--shadow); }

    .drop-in{ opacity:0; transform:translateY(-24px); animation:drop-in .6s ease-out .05s both; }
    .drop-in.delay{ animation-delay:.18s; }
    @media (max-width:900px){
      .social .fb-wrap{ order:1 }
      .social .side-panel{ order:2 }
    }

    /* ===== Results table styles ===== */
    .results-title{ font-size:16px; font-weight:800; color:var(--ink); margin:6px 2px 8px; }
    .results-table{ width:100%; border-collapse:separate; border-spacing:0; table-layout:auto; } /* CHANGED: separate + spacing 0 for rounded corners */
    .results-table th, .results-table td{ padding:10px 14px; border-bottom:1px solid #e9e9e9; word-break:break-word; }
    .results-table th{ text-align:left; font-weight:800; }

    /* ✅ Rounded corners ensured on results wrapper */
    .results-wrap{ background:var(--paper); color:var(--ink); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px; overflow:hidden; }
    .results-scroll{ max-height:clamp(360px, 58vh, 620px); overflow-y:auto; overflow-x:hidden; border-radius:inherit; }
    .results-note{ font-size:13px; color:#777; margin:6px 0 0; }

    /* === FORCE results column to match smash cut height on desktop === */
    @media (min-width:901px){
      .register-grid{ align-items:stretch; }
      .register-cta{
        height:var(--video-h);               /* exact match */
        grid-template-rows:auto auto auto 1fr; 
        overflow:hidden;
      }
      .results-wrap{
        height:100%;
        display:flex; flex-direction:column;
      }
      .results-scroll{ flex:1; min-height:0; }
    }
  </style>
</head>
<body>

  <!-- Ticker -->
  <div class="ticker" id="scoreTicker" aria-label="Latest result per team">
    <div class="lane" id="tickerLane">
      <div class="track" id="tickerTrack">
        <span class="copy"><span class="chunk">Loading latest results…</span></span>
        <span class="copy" aria-hidden="true"><span class="chunk">Loading latest results…</span></span>
      </div>
    </div>
  </div>

  <header id="site-header" role="navigation" aria-label="Primary">
    <div class="nav container">
      <div class="brand">
        <img class="logo" src="img/dudley-logo.png" alt="Dudley Redhead Junior Rugby League Club logo">
        <span>Dudley Redhead JRLC</span>
      </div>
      <nav class="menu" aria-label="Main menu">
        <a href="#register">Register</a>
        <a href="#shop">Shop</a>
        <a href="#news">News</a>
        <a href="#upcoming">Games/Results</a>
      </nav>
    </div>
  </header>

  <section class="hero" id="hero" aria-label="Opening Splash">
    <div class="hero-inner">
      <aside class="games-card" id="upcoming" aria-label="Upcoming Games">
        <h2>Upcoming Games</h2>
        <ul class="game-list" id="gameList" aria-live="polite"></ul>
        <p class="source">
          Source: <a href="https://www.playrugbyleague.com/competitions/" target="_blank" rel="noopener">Play Rugby League / MySideline</a>
          <span id="fullFixturesLink"></span>
        </p>
        <div class="badge" id="gameday-badge" hidden><span class="dot"></span><span>GAME DAY</span></div>
      </aside>

      <div class="pitch" id="pitch">
        <svg id="pitchSvg" viewBox="0 0 1000 560" preserveAspectRatio="xMidYMid slice" aria-label="Pitch">
          <defs>
            <linearGradient id="grass" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#0b0b0b"/><stop offset="100%" stop-color="#020202"/>
            </linearGradient>
            <filter id="drops" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="6" result="blur" />
              <feOffset dx="0" dy="6" result="off" />
              <feColorMatrix type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 .35 0" />
              <feBlend in="SourceGraphic" mode="normal" />
            </filter>
          </defs>
          <rect x="0" y="0" width="1000" height="560" fill="url(#grass)"/>
          <rect x="0" y="500" width="1000" height="2" fill="#e7e7e7" opacity=".9"/>
          <g id="posts" transform="translate(780,260)">
            <rect x="0"   y="0" width="12" height="220" fill="#f5f5f5"/>
            <rect x="120" y="0" width="12" height="220" fill="#f5f5f5"/>
            <rect id="crossbar" x="0" y="80" width="132" height="12" fill="#f5f5f5"/>
          </g>
          <g id="ballAnchor" filter="url(#drops)">
            <g id="ball" class="bounce-once">
              <ellipse cx="0" cy="0" rx="36" ry="22" fill="#ffffff"/>
              <path d="M -28,-6 C -8,-16 8,-16 28,-6" stroke="#d9d9d9" stroke-width="2" fill="none"/>
              <path d="M -28, 6 C -8, 16 8, 16 28, 6" stroke="#d9d9d9" stroke-width="2" fill="none"/>
              <line x1="-4" y1="0" x2="4" y2="0" stroke="#d9d9d9" stroke-width="2"/>
              <line x1="-2" y1="-4" x2="-2" y2="4" stroke="#d9d9d9" stroke-width="2"/>
              <line x1="2" y1="-4"  x2="2"  y2="4" stroke="#d9d9d9" stroke-width="2"/>
            </g>
          </g>
        </svg>
        <h1 class="hero-title">Mighty Magpies</h1>
      </div>
    </div>
  </section>

  <section class="dark" id="register" aria-label="Register">
    <div class="container register-grid">
      <div class="video">
        <video id="promoVideo" src="" preload="metadata" muted playsinline poster="" aria-label="Club highlight video"></video>
      </div>
      <div class="register-cta">
        <h2>Join the Magpies</h2>
        <p class="lead">Register now to play junior rugby league with Dudley Redhead Junior Rugby League Club. All registrations are via the official MySideline system.</p>
        <a class="btn animate-bounce" href="https://www.playrugbyleague.com/mysideline/" target="_blank" rel="noopener">Register at MySideline</a>

        <!-- ===== Recent Results ===== -->
        <div class="results-wrap" aria-label="Recent Results (compact)">
          <div class="results-title">Recent Results</div>
          <div class="results-scroll">
            <table class="results-table" id="resultsTable" aria-describedby="resultsNote">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Round</th>
                  <th>Home</th>
                  <th>Score / Status</th>
                  <th>Away</th>
                </tr>
              </thead>
              <tbody id="resultsTbody">
                <tr><td colspan="5">Loading results…</td></tr>
              </tbody>
            </table>
          </div>
          <p class="results-note" id="resultsNote">Showing the most recent matches scraped from Play Rugby League.</p>
        </div>
        <!-- ===== End embedded results ===== -->
      </div>
    </div>
  </section>

  <section class="light" id="shop" aria-label="Shop Merchandise">
    <div class="container shop">
      <h2>Magpies Merchandise</h2>
      <p class="lead" style="color:#2a2a2a">Browse official gear. We’ll plug in the local manufacturer’s feed next.</p>
      <div class="shop-grid" role="list" aria-label="Shop grid">
        <article class="card" role="listitem" aria-label="Magpies tee">
          <div class="img">Image</div><div class="body"><strong>Magpies Tee</strong><span>$25.00</span></div>
        </article>
        <article class="card" role="listitem" aria-label="Home jersey">
          <div class="img">Image</div><div class="body"><strong>Home Jersey</strong><span>$60.00</span></div>
        </article>
        <article class="card" role="listitem" aria-label="Club cap">
          <div class="img">Image</div><div class="body"><strong>Club Cap</strong><span>$18.00</span></div>
        </article>
        <article class="card" role="listitem" aria-label="Hoodie">
          <div class="img">Image</div><div class="body"><strong>Winter Hoodie</strong><span>$75.00</span></div>
        </article>
      </div>
    </div>
  </section>

  <section class="dark sponsors" id="sponsors" aria-label="Our Sponsors">
    <div class="container">
      <h2>Sponsors</h2>
      <div class="grid" role="list">
        <a href="#" role="listitem"><img src="" alt="Sponsor 1 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 2 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 3 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 4 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 5 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 6 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 7 (placeholder)"></a>
        <a href="#" role="listitem"><img src="" alt="Sponsor 8 (placeholder)"></a>
      </div>
    </div>
  </section>

  <section class="light about" id="about" aria-label="About the Club">
    <div class="container">
      <h2>About Us</h2>
      <p class="lead">Proudly community-based. 2020 marked our 50<sup>th</sup> season in junior rugby league.</p>
      <p>We are the Dudley Redhead Junior Rugby League Club – the Mighty Magpies – playing at John Balcomb Field (Dudley). Our focus is on how we care for, grow, and develop youth through sport.</p>
    </div>
  </section>

  <section class="dark social" id="news" aria-label="Social Feed">
    <div class="container">
      <h2>Facebook</h2>

      <div class="social-row">
        <div class="fb-wrap">
          <iframe
            src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2FDudleyRedheadJrlfcMightyMagpies%2F&tabs=timeline&width=500&height=700&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId"
            width="500" height="700" style="border:none;overflow:hidden" scrolling="no" frameborder="0"
            allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
        </div>

        <div class="side-panel">
          <div class="intro">
            <h3 class="drop-in">The Hottest Swoops </h3>
            <p class="drop-in delay">Our Facebook is the most up-to-date — tune in for scores, photos, and announcements.</p>
          </div>
          <figure class="side-image">
            <img src="img/bird.png" alt="Magpie artwork alongside the Facebook feed">
          </figure>
        </div>
      </div>
    </div>
  </section>

  <!-- Feats hover-roller -->
  <section class="light feats" id="feats" aria-label="Club Highlights">
    <div class="container">
      <h2>Club Highlights</h2>
      <div class="feats-row" id="featsRow" role="list"></div>
    </div>
  </section>

  <footer class="dark">
    <div class="container">© <span id="year"></span> Dudley Redhead Junior Rugby League Club. All rights reserved.</div>
  </footer>

  <script type="application/json" id="sample-games">
  [
    {"date":"2025-08-15T14:00:00+10:00","opponent":"South Newcastle Lions","homeAway":"Home","venue":"John Balcomb Field","score":" - ","result":null},
    {"date":"2025-08-22T18:00:00+10:00","opponent":"Central Charlestown Butcher Boys","homeAway":"Away","venue":"St John Oval","score":"24 - 18","result":"Win"}
  ]
  </script>

  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v20.0" nonce="DUDLEYFB"></script>

  <script>
    const CONFIG = {
      fixturesDeepLink: "",
      gamesJsonUrl: "games.json",
      promoVideo: "img/smashcut.mp4",
      groundStatusUrl: "https://script.google.com/macros/s/AKfycby_kAXDcQKQ1tJQmRCii91iXPn-mxB0hRq6NTf09U1nUMt9nt0xjjy1oTo0hiLx8af-/exec",
      groundStatusDetailsUrl: "#about",
      featsJsonUrl: "feats.json",
      apifyResultsUrl: "https://api.apify.com/v2/datasets/yoBLwX2yoAmMG6N8e/items?clean=true&format=json&limit=1000"
    };
    const $ = s => document.querySelector(s);
    $('#year').textContent = new Date().getFullYear();

    window.__GROUND_CLOSED = false;
    (async function groundStatus(){
      try{
        if(!CONFIG.groundStatusUrl) return;
        const res = await fetch(`${CONFIG.groundStatusUrl}?t=${Date.now()}`, {cache:'no-store'});
        if(!res.ok) throw new Error('status fetch failed');
        const data = await res.json();
        if(data && data.is_closed){
          window.__GROUND_CLOSED = true;
          const bar=document.getElementById('scoreTicker'), lane=document.getElementById('tickerLane');
          if(bar&&lane){
            bar.classList.add('closed');
            lane.innerHTML = `<span class="chunk"><strong>GROUND CLOSED</strong> — ${data.note || 'Field unavailable'}</span>
              <span class="chunk">Updated ${data.updatedAt || ''} · <a href="${CONFIG.groundStatusDetailsUrl}" style="text-decoration:underline">Details</a></span>`;
          }
        }
      }catch(e){ console.warn('Ground status fetch failed', e); }
    })();

    (function promoVideo(){
      const video = $('#promoVideo');
      if (CONFIG.promoVideo) video.src = CONFIG.promoVideo;
      if (!video) return;
      let half = null;
      video.addEventListener('loadedmetadata', () => {
        const d = video.duration || 0; half = d>0? d/2 : null; if (!video.seeking) video.currentTime = 0;
      });
      video.addEventListener('timeupdate', () => {
        if (half && video.currentTime >= (half - 0.05)) { video.currentTime = 0; if (video.paused) video.play().catch(()=>{}); }
      });
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if (e.isIntersecting && e.intersectionRatio>=0.4) video.play().catch(()=>{}); else video.pause(); });
      }, { threshold:[0,.4,1] });
      io.observe(video);
    })();

    (async function upcoming(){
      const list = $('#gameList'), badge = $('#gameday-badge'), fixturesLink = $('#fullFixturesLink');
      if (CONFIG.fixturesDeepLink){
        fixturesLink.innerHTML = ` · <a href="${CONFIG.fixturesDeepLink}" target="_blank" rel="noopener">Full fixtures</a>`;
      }
      const CACHE_KEY = 'dudley_games_cache_v1', MAX_AGE_MS = 21600000;
      function getInlineSample(){ try{ return JSON.parse(document.getElementById('sample-games').textContent.trim()); }catch{ return []; } }
      function loadCache(){ try{ const raw=localStorage.getItem(CACHE_KEY); if(!raw) return null; const {at,data}=JSON.parse(raw); if(Date.now()-at>MAX_AGE_MS) return null; return data; }catch{ return null; } }
      function saveCache(data){ try{ localStorage.setItem(CACHE_KEY, JSON.stringify({at:Date.now(), data})); }catch{} }
      async function fetchGames(){ if(!CONFIG.gamesJsonUrl) throw new Error('no games url'); const res=await fetch(CONFIG.gamesJsonUrl,{cache:'no-store'}); if(!res.ok) throw new Error('fetch failed'); return res.json(); }
      let games = loadCache();
      if(!games){ try{ games = await fetchGames(); saveCache(games); } catch{ games = getInlineSample(); } }
      const now = new Date();
      const upcomingGames = games.filter(g => new Date(g.date) >= now).sort((a,b)=> new Date(a.date) - new Date(b.date));
      function toAU(dstr){ const d=new Date(dstr); return `${d.toLocaleDateString('en-AU',{weekday:'short',day:'numeric',month:'short'})}, ${d.toLocaleTimeString('en-AU',{hour:'2-digit',minute:'2-digit'})}`; }
      function isToday(dstr){ const d=new Date(dstr), n=new Date(); return d.getFullYear()===n.getFullYear() && d.getMonth()===n.getMonth() && d.getDate()===n.getDate(); }
      list.innerHTML = upcomingGames.length ? '' : '<li class="game"><div class="row"><span class="meta">No upcoming games loaded.</span></div></li>';
      let hasToday = false;
      upcomingGames.forEach(g=>{
        if (isToday(g.date)) hasToday = true;
        const li=document.createElement('li'); li.className='game';
        li.innerHTML = `<div class="row"><span class="when">${toAU(g.date)}</span><span class="meta">${g.homeAway} vs ${g.opponent} @ ${g.venue}</span></div>`;
        list.appendChild(li);
      });
      badge.hidden = !hasToday;
    })();

    /* ===== Ball arc interaction ===== */
    (function heroBall(){
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const anchor= document.getElementById('ballAnchor'), ball= document.getElementById('ball');

      const start = { x: 410, y: 500 },
            uprightsCenterX = 780 + (132/2),
            crossbarY = 260 + 80,
            target = { x: uprightsCenterX, y: crossbarY - 30 };

      anchor.style.transform = `translate(${start.x}px,${start.y}px)`;
      if (prefersReduced) ball.classList.remove('bounce-once');

      let fired=false, animId=null;
      const cancelAnim=()=>{ if(animId){ cancelAnimationFrame(animId); animId=null; } };

      function animateArc(){
        if (prefersReduced) return;
        cancelAnim();
        const dur=920, t0=performance.now(),
              ctrl={ x:(start.x+target.x)/2+40, y: Math.min(start.y,target.y)-180 };
        function step(now){
          let t=(now-t0)/dur; if(t>1) t=1; const omt=1-t;
          const x=omt*omt*start.x + 2*omt*t*ctrl.x + t*t*target.x;
          const y=omt*omt*start.y + 2*omt*t*ctrl.y + t*t*target.y;
          anchor.style.transform = `translate(${x}px,${y}px)`;
          ball.style.transform = `rotate(${-140*t}deg)`;
          ball.style.opacity = String(1 - Math.max(0,(t-0.75)/0.25));
          if(t<1) animId=requestAnimationFrame(step); else animId=null;
        }
        animId=requestAnimationFrame(step);
      }

      function resetBall(){
        cancelAnim();
        anchor.style.transform = `translate(${start.x}px,${start.y}px)`;
        ball.style.transform='rotate(0deg)';
        ball.style.opacity='';
        if(!prefersReduced){
          ball.classList.remove('bounce-once','small-hop');
          void ball.offsetWidth;
          ball.classList.add('small-hop');
          setTimeout(()=>ball.classList.remove('small-hop'), 720);
        }
      }

      function onScroll(){
        const trigger = window.pageYOffset>0;
        if(trigger && !fired){ animateArc(); fired=true; }
        if(window.pageYOffset===0){
          if(fired) resetBall();
          fired=false;
        }
      }

      window.addEventListener('scroll', onScroll, { passive:true });
      window.addEventListener('resize', onScroll);
      onScroll();
    })();

    // ===== Feats hover-roller =====
    (async function featsHoverRoller(){
      const row = document.getElementById('featsRow');
      if (!row) return;
      const fallbackImg = "img/dudley-logo.png";
      const url = CONFIG.featsJsonUrl || "feats.json";
      try{
        const res = await fetch(url, { cache:'no-store' });
        if(!res.ok) throw new Error('feats fetch failed');
        const items = await res.json();
        const take = items.slice(0,5);

        take.forEach((it, idx, arr)=>{
          const card=document.createElement('article');
          card.className='feat-card'; card.setAttribute('role','listitem'); card.setAttribute('tabindex','0');

          const sideClass = (idx >= arr.length - 3) ? 'fly-left' : 'fly-right';

          const primary = (it.image_url && it.image_url.trim()) ? it.image_url : fallbackImg;
          const alt =
            it.alt_image_url || it.image_alt_url ||
            (Array.isArray(it.image_urls) && it.image_urls[1]) ||
            (Array.isArray(it.images) && it.images[1]) || "";

          card.innerHTML = `
            <div class="frame ${sideClass}">
              <div class="art">
                <div class="img primary" style="background-image:url('${primary}')"></div>
                ${alt ? `<div class="img alt" style="background-image:url('${alt}')"></div>` : ``}
                <a class="cover" href="${it.primary_link_url || '#'}" target="_blank" rel="noopener"
                   aria-label="${(it.primary_link_text || 'Open').replace(/"/g,'&quot;')}"></a>
                <div class="meta">
                  ${it.tag ? `<span class="tag">${it.tag}</span>` : ``}
                  <h3>${it.title || ''}</h3>
                  ${it.subtitle ? `<p>${it.subtitle}</p>` : ``}
                </div>
              </div>
              <aside class="flyout" aria-hidden="true">
                <div class="fly-body">${(it.extended || '').toString().replace(/</g,'&lt;')}</div>
              </aside>
            </div>
          `;
          row.appendChild(card);
        });

        const isTouch = window.matchMedia('(hover:none)').matches;
        if (isTouch) {
          row.addEventListener('click', (e)=>{
            const card = e.target.closest('.feat-card'); if(!card) return;
            row.querySelectorAll('.feat-card').forEach(c=>{ if(c!==card) c.classList.remove('active'); });
            card.classList.toggle('active');
          });
        }
      }catch(err){
        console.warn('Feats load failed', err);
      }
    })();

    /* ===== Apify dataset → banner + results table ===== */
    (async function apifyResults(){
      try{
        if (!CONFIG.apifyResultsUrl) return;

        const CACHE_KEY = 'dudley_apify_results_v1';
        const MAX_AGE_MS = 30 * 60 * 1000;

        const loadCache = () => {
          try{
            const raw = localStorage.getItem(CACHE_KEY);
            if(!raw) return null;
            const { at, data } = JSON.parse(raw);
            if (Date.now() - at > MAX_AGE_MS) return null;
            return data;
          }catch{ return null; }
        };
        const saveCache = (data) => {
          try{ localStorage.setItem(CACHE_KEY, JSON.stringify({ at: Date.now(), data })); }catch{}
        };

        let items = loadCache();
        if (!items){
          const res = await fetch(CONFIG.apifyResultsUrl, { cache: 'no-store' });
          if (!res.ok) throw new Error('apify fetch failed');
          items = await res.json();
          saveCache(items);
        }

        const parseSafe = (s) => {
          if (!s) return null;
          const t = Date.parse(s);
          return Number.isFinite(t) ? new Date(s) : null;
        };
        const data = items
          .map(it => ({ ...it, _d: parseSafe(it.date_iso) || parseSafe(it.date) }))
          .filter(it => it._d)
          .sort((a,b)=> b._d - a._d);

        /* Ticker build (unchanged) */
        if (!window.__GROUND_CLOSED){
          const lane = document.getElementById('tickerLane');
          const bar  = document.getElementById('scoreTicker');
          if (lane && bar){
            const latestByTeam = new Map();
            const isDudley = (name='') => /dudley\s*redhead/i.test(name);
            const dudleySide = (it) => isDudley(it.home) ? 'home' : (isDudley(it.away) ? 'away' : null);

            function teamKeyAndLabel(raw=''){
              const s = String(raw || '').replace(/\s+/g,' ').trim();
              const ageMatch = s.match(/\bU(?:nder)?\s*(\d{1,2})\b/i);
              const divMatch = s.match(/\bDiv(?:ion|ision)?\s*-?\s*(\d)\b/i);
              const age = ageMatch ? ageMatch[1] : null;
              const div = divMatch ? divMatch[1] : null;
              if (!age) return { key: s.toLowerCase(), label: s };
              const label = `U${age}${div ? ` Div ${div}` : ''}`;
              const key = `u${age}${div?`-div${div}`:''}`;
              return { key, label };
            }

            for (const it of data){
              const side = dudleySide(it);
              if (!side) continue;
              const dudleyName = side === 'home' ? (it.home || '') : (it.away || '');
              const { key, label } = teamKeyAndLabel(dudleyName);
              if (latestByTeam.has(key)) continue;
              if (!((it.score && String(it.score).trim()) || (it.status && String(it.status).trim()))) continue;
              latestByTeam.set(key, { it, label });
            }

            const ordered = [...latestByTeam.values()].sort((a,b)=>{
              const getAge = x => { const m = x.label.match(/U(\d{1,2})/i); return m ? parseInt(m[1],10) : 999; };
              const getDiv = x => { const m = x.label.match(/Div\s*(\d)/i); return m ? parseInt(m[1],10) : 99; };
              const ageDiff = getAge(a) - getAge(b);
              if (ageDiff !== 0) return ageDiff;
              return getDiv(a) - getDiv(b);
            });

            const trackId = 'tickerTrack';
            let track = document.getElementById(trackId);
            if (!track){
              lane.innerHTML = `<div class="track" id="${trackId}"></div>`;
              track = document.getElementById(trackId);
            }

            if (!ordered.length){
              track.innerHTML = `<span class="copy"><span class="chunk">No results found for Dudley teams yet</span></span><span class="copy" aria-hidden="true"><span class="chunk">No results found for Dudley teams yet</span></span>`;
              track.style.setProperty('--marquee-duration','30s');
            } else {
              const chunks = ordered.map(({ it, label })=>{
                const ds = it._d.toLocaleDateString('en-AU',{ weekday:'short', day:'numeric', month:'short' });
                const tag = (it.status && String(it.status).trim()) ? String(it.status).trim() :
                            (it.score ? `<strong>${String(it.score).trim()}</strong>` : '-');
                const home = it.home || '', away = it.away || '';
                return `<span class="chunk"><strong>${label}</strong> · ${ds}: ${home} vs ${away} — ${tag}</span><span class="dot">•</span>`;
              }).join('');
              track.innerHTML = `<span class="copy">${chunks}</span><span class="copy" aria-hidden="true">${chunks}</span>`;
              const start = async () => {
                try{ if (document.fonts && document.fonts.ready) await document.fonts.ready; }catch{}
                requestAnimationFrame(()=>{
                  const copy = track.querySelector('.copy');
                  if (!copy) return;
                  const w = copy.getBoundingClientRect().width;
                  const pxPerSec = 120;
                  const dur = Math.max(20, Math.round(w / pxPerSec));
                  track.style.setProperty('--marquee-duration', `${dur}s`);
                });
              };
              start();
            }

            function onScroll(){
              if (window.pageYOffset > 10){
                bar.classList.add('hidden'); document.documentElement.style.setProperty('--ticker-offset','0px');
              } else {
                bar.classList.remove('hidden'); document.documentElement.style.setProperty('--ticker-offset','var(--ticker-h)');
              }
            }
            window.addEventListener('scroll', onScroll, { passive:true }); onScroll();
          }
        }

        /* Results table */
        const tbody = document.getElementById('resultsTbody');
        if (tbody){
          const rows = data.slice(0, 50).map(it => {
            const ds = it._d.toLocaleDateString('en-AU', { weekday:'short', day:'numeric', month:'short', year:'numeric' });
            const label = (it.status && it.status.trim()) ? it.status.trim() : (it.score || '').trim();
            return `<tr>
              <td>${ds}</td>
              <td>${it.round || ''}</td>
              <td>${it.home || ''}</td>
              <td>${label || '-'}</td>
              <td>${it.away || ''}</td>
            </tr>`;
          }).join('');
          tbody.innerHTML = rows || '<tr><td colspan="5">No results available.</td></tr>';
        }
      }catch(err){
        console.warn('Apify results failed', err);
        const tbody = document.getElementById('resultsTbody');
        if (tbody) tbody.innerHTML = '<tr><td colspan="5">Failed to load results.</td></tr>';
      }
    })();
  </script>
</body>
</html>
